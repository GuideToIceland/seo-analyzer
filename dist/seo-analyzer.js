!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("cli-progress"),require("colors"),require("express"),require("path"),require("cfonts"),require("fs"),require("jsdom"),require("axios"),require("sitemap-stream-parser")):"function"==typeof define&&define.amd?define(["cli-progress","colors","express","path","cfonts","fs","jsdom","axios","sitemap-stream-parser"],t):(e="undefined"!=typeof globalThis?globalThis:e||self)["seo-analyzer"]=t(e.cliProgress,e._colors,e.express,e.path,e.CFonts,e.fs,e.jsdom,e.axios,e.sitemaps)}(this,(function(e,t,r,s,n,i,o,l,a){"use strict";const h={titleLengthRule:function(e,t){return new Promise((r=>{const s=e.window.document.querySelector("title");s||r("This HTML is missing a <title> tag");const n=s.length;n<t.min&&r(`<title> too short(${n}). The minimum length should be ${t.min} characters.`),n>t.max&&r(`<title> too long(${n}). The maximum length should be ${t.max} characters.`),r(null)}))},imgTagWithAltAttributeRule:function(e){return new Promise((t=>{let r=0,s=0;const n=[];e.window.document.querySelectorAll("img").forEach((e=>{e.alt||r++,e.src||s++})),s>0&&n.push(`There are ${s} <img> tags without a src attribute`),r>0&&n.push(`There are ${r} <img> tags without an alt attribute`),(s||r)&&t(n),t(null)}))},aTagWithRelAttributeRule:function(e){return new Promise((t=>{let r=0;e.window.document.querySelectorAll("a").forEach((e=>{e.rel||r++})),r>0&&t(`There are ${r} <a> tags without a rel attribute`),t(null)}))},canonicalLinkRule:function(e){return new Promise((t=>{const r=e.window.document.querySelector('head > link[rel="canonical"]');r||t('This HTML is missing a <link rel="canonical" href="..."> link'),r&&!r.href&&t("The canonical link is missing an href attribute"),r&&"/"!==r.href.substr(-1)&&t("The href attribute does not have a slash at the end of the link."),t(null)}))},metaBaseRule:function(e,t={list:[]}){return new Promise((r=>{const s=[];t&&t.names&&t.names.length&&t.names.forEach((t=>{const r=e.window.document.querySelector(`head > meta[name="${t}"]`);r?r.content||s.push(`The content attribute for the <meta name="${t}" content=""> tag is empty`):s.push(`This HTML is missing a <meta name="${t}"> tag`)})),r(s)}))},metaSocialRule:function(e,t={properties:[]}){return new Promise((r=>{const s=[];t&&t.properties&&t.properties.length&&t.properties.forEach((t=>{const r=e.window.document.querySelector(`head > meta[property="${t}"]`);r?r.content||s.push(`The content attribute for the <meta property="${t}" content=""> tag is empty`):s.push(`This HTML is missing a <meta property="${t}"> tag`)})),r(s)}))}};class u{constructor(e){this.level="default"===e?2:["trace","debug","info","result","success","error"].indexOf(e)}result(e,t=!1){this.level>3&&!t||this._logResult(e)}error(e,t){this.level>5||(this._logError(e),t&&process.exit(1))}success(e){this.level>4||this._logSuccess(e)}info(e){this.level>2||this._logInfo(e)}printTextToConsole(e){if(this.level>2)return;const t=e.replace(" ","|");n.say(t,{font:"block",align:"left",colors:["system"],background:"transparent",letterSpacing:1,lineHeight:1,space:!0,maxLength:"0",gradient:!1,independentGradient:!1,transitionGradient:!1,env:"node"})}_logResult(e){if(!e.some((e=>e.report.length)))return this._logSuccess("\nüëç  No SEO defects detected.\n");this._logInfo("\nüöÄ  Issue report");for(const t of e)this._logInfo(`\nSource: ${t.source.trim()}`),this._logError(`${t.report.join("\n")}`);return this._logSuccess("\n-------- üöÄ Finished! --------\nThanks for using Seo Analyzer!\n"),process.exit(1)}_logError(e){console.error(`${t.red(e)}`)}_logInfo(e){console.log(`${t.yellow(e)}`)}_logSuccess(e){console.log(`${t.green(e)}`)}}class g{constructor(r){this.logger=r??new u,this.consoleProgressBar=this.logger.level<=4&&new e.Bar({format:"Processing... |"+t.green("{bar}")+"| {percentage}% || {value}/{total} Pages",barCompleteChar:"‚ñà",barIncompleteChar:"‚ñë",hideCursor:!0}),this.inputUrl="",this.ignoreUrls=""}async run(e,t,r){this.inputUrl=`http://localhost:${e}`,this.ignoreUrls=t;const s=await this._getLinksFromSitemap(r);return await this._getHtmlDomFromLinks(s)}_getLinksFromSitemap(e){return this.logger.info(`üöÄ  Get sitemap from ${this.inputUrl}\n`),new Promise((t=>{const r=`${this.inputUrl}/${e}`,s=[];a.parseSitemaps(r,(e=>{const t=e.replace(/^.*\/\/[^/]+/,"");-1===this.ignoreUrls.indexOf(t)&&s.push(this._formatLink(e))}),(e=>{e?this.logger.error("‚ùå  Sitemap not found\n",1):s.length?(this.logger.success("‚úÖ  Done\n"),t(s)):this.logger.error("‚ùå  Links not found\n",1)}))}))}_formatLink(e){return e.replace(/^.*\/\/[^/]+/,this.inputUrl)}sleep(e){return new Promise((t=>setTimeout(t,e)))}async _getHtmlDomFromLinks(e){const r=[],s=[];this.logger.info("üöÄ  Parsing HTML\n"),this.logger.level<=4&&this.consoleProgressBar.start(e.length,0);for(const n of e)s.push(l.get(n).then((e=>{e&&200===e.status&&r.push({source:n,text:e.data})})).catch((e=>{const r=e&&e.response&&e.response.status||500;this.logger.error(`Error: ${e} - ${n}`),this.logger.error(`\n${t.yellow("==>")} ${t.white(n)} ${t.red(r)}`)})).finally((()=>{this.logger.level<=4&&this.consoleProgressBar.increment()}))),await this.sleep(500);return Promise.all(s).then((()=>(this.logger.level<=4&&this.consoleProgressBar.stop(),r)))}}class c{constructor(r){this.logger=r??new u,this.scraper=new g(this.logger),this.consoleProgressBar=this.logger.level<=4&&new e.Bar({format:"Processing... |"+t.green("{bar}")+"| {percentage}% || {value}/{total} Folders",barCompleteChar:"‚ñà",barIncompleteChar:"‚ñë",hideCursor:!0}),this.badType='The inputFiles function takes an array only ["index.html", "...", "..."]',this.emptyList='You need to pass an array to the inputFiles function ["index.html", "...", "..."]',this.ignoreFolders=[],this.ignoreFiles=[]}async files(e=[],t=[]){Array.isArray(e)&&e.length||this.logger.error('‚ùå  The "inputFiles" method expects an array of files.\n',!0),Array.isArray(t)||this.logger.error('‚ùå  The "ignoreFiles" method expects an array of ignore files.\n',!0),this.logger.info("\nüöÄ  Parsing files\n"),0===e.length&&this.logger.error(this.emptyList),Array.isArray(e)||this.logger.error(this.badType),this.ignoreFiles=t;const r=await this._getHtml(e);return await this.getDom(r)}async folders(e=[],t=[],r=[]){Array.isArray(e)&&e.length||this.logger.error('‚ùå  The "inputFolders" method expects an array of folders.\n',!0),Array.isArray(t)||this.logger.error('‚ùå  The "ignoreFolders" method expects an array of ignore folders.\n',!0),this.logger.info("üöÄ  Parsing folders\n"),this.logger.level<=4&&this.consoleProgressBar.start(e.length,0),this.ignoreFolders=t,this.ignoreFiles=r;const s=await this._getFilesFromFolders(e);return await this.files(s,r)}async spa(e,t=[],r){const s=await this.scraper.run(e,t,r);return await this.getDom(s)}async _getFilesFromFolders(e=[]){const t=[];for(const r of e){const e=await this._getFilesFromFolder(r);this.logger.level<=4&&this.consoleProgressBar.increment(),t.push(...e)}return this.logger.level<=4&&this.consoleProgressBar.stop(),t.length||this.logger.error("\n‚ùå  No files found.\n",!0),t}_getFilesFromFolder(e=""){try{const t=i.readdirSync(e).map((t=>s.join(e,t))),r=t.filter((e=>i.statSync(e).isFile()&&".html"===s.extname(e))),n=t.filter((e=>!r.includes(e)&&i.statSync(e).isDirectory())).filter((e=>!this.ignoreFolders.includes(e))).reduce(((e,t)=>e.concat(this._getFilesFromFolder(t))),[]);return[...r,...n]}catch(t){return this.logger.error(`\n\n‚ùå Folder "${e}" not found\n`),[]}}_getHtml(r){const s=[],n=this.logger.level<=4&&new e.Bar({format:"Processing... |"+t.green("{bar}")+"| {percentage}% || {value}/{total} Sources",barCompleteChar:"‚ñà",barIncompleteChar:"‚ñë",hideCursor:!0});return this.logger.level<=4&&n.start(r.length,0),r.forEach((e=>{if(!this.ignoreFiles.includes(e))try{const t=i.readFileSync(e,"utf8");s.push({source:e,text:t}),this.logger.level<=4&&n.increment()}catch(t){this.logger.level<=4&&n.increment(),this.logger.error(`\n\nFile "${e}" not found\n`)}})),this.logger.level<=4&&n.stop(),s.length||this.logger.error("\n‚ùå  No files found.\n",!0),s}getDom(r){const s=[],n=this.logger.level<=4&&new e.Bar({format:"Handling html |"+t.green("{bar}")+"| {percentage}% || {value}/{total} Sources",barCompleteChar:"‚ñà",barIncompleteChar:"‚ñë",hideCursor:!0});this.logger.info("\nüöÄ  Getting DOM from HTML\n"),this.logger.level<=4&&n.start(r.length,0);const i=new o.VirtualConsole;return r.forEach((e=>{let t=new o.JSDOM(e.text,{virtualConsole:i});s.push({source:e.source,dom:t}),this.logger.level<=4&&n.increment()})),this.logger.level<=4&&n.stop(),s}}class p{constructor(r){this.logger=r??new u,this.consoleProgressBar=this.logger.level<=4&&new e.Bar({format:"Running rules |"+t.green("{bar}")+"| {percentage}% || {value}/{total} Rules",barCompleteChar:"‚ñà",barIncompleteChar:"‚ñë",hideCursor:!0}),this.badType='The inputFiles function takes an array only ["index.html", "...", "..."]',this.emptyList='You need to pass an array to the inputFiles function ["index.html", "...", "..."]'}async run(e,t){0===e.length&&this.logger.error(this.emptyList),Array.isArray(e)||this.logger.error(this.badType);return await this._startAnalyzer(e,t)}async _startAnalyzer(e,r){const s=[];for(const n of e){this.logger.info(`\n${t.blue("==>")} Analysis ${t.white(n.source)}`);const e=await this._analyzeDOM(n.dom,r);e&&e.length&&s.push({source:n.source,report:e})}return s}async _analyzeDOM(e,t){const r=[];this.logger.level<=4&&this.consoleProgressBar.start(t.length,0);for(const s of t){let t=null;try{t=await s.rule(e,s.options)}catch(e){t=e}Array.isArray(t)?r.push(...t):t&&r.push(t),this.logger.level<=4&&this.consoleProgressBar.increment()}return this.logger.level<=4&&this.consoleProgressBar.stop(),r}}class m{constructor(e){this.analyzer=new p(e)}async object(e,t){return await this.analyzer.run(e,t)}async json(e,t){const r=await this.analyzer.run(e,t);return JSON.stringify(r,null,2)}}const f=r();var d=Object.freeze({__proto__:null,default:class{constructor(e){this.logger=e??new u,this._input=new c(e),this.app={},this.handle={},this.status={},this.port=parseInt(process.env.PORT,10)||3e3}async setup(){const{default:e}=await import("next");this.app=e({dev:!1}),this.handle=this.app.getRequestHandler()}run(){return new Promise(((e,t)=>{this.app.prepare().then((()=>{const t=r();t.all("*",((e,t)=>this.handle(e,t))),t.listen(this.port,(t=>{if(t)throw t;this.logger.info(`üöÄ  Ready on http://localhost:${this.port}\n`),e({status:"Active"})}))})).catch((e=>{this.logger.error("‚ùå  Error Starting Server\n"),console.error(e.stack),process.exit(1),t(new Error("Error Starting Server"))}))}))}async inputSSR(e,t=[],r){this.port=e,this.status=await this.run();return this._input.spa(this.port,t,r)}}});return class{constructor({verbose:e=!0}){return this._logger=new u(e?"default":"error"),this._input=new c(this._logger),this._output=new m(this._logger),this._nextServer=null,this._inputData=[],this._defaultRules=h,this._rules=[],this._ignoreFolders=[],this._ignoreFiles=[],this._ignoreUrls=[],this}ignoreFiles(e){return this._ignoreFiles=e,this}ignoreFolders(e){return this._ignoreFolders=e,this}ignoreUrls(e){return this._ignoreUrls=e,this}async inputFiles(e){return 0!==this._inputData.length||(this._logger.printTextToConsole("SEO Analyzer"),this._inputData=await this._input.files(e,this._ignoreFiles)),this}async inputFolders(e){return 0!==this._inputData.length||(this._logger.printTextToConsole("SEO Analyzer"),this._inputData=await this._input.folders(e,this._ignoreFolders,this._ignoreFiles)),this}async inputSpaFolder(e,t="sitemap.xml",n=9999){return this._inputData?(this._logger.printTextToConsole("SEO Analyzer"),function(e,t){const n=new u;f.use(r.static(e)),f.get("/",((e,t)=>{t.sendFile(s.join(__dirname,"/index.html"))})),f.listen(t),n.info(`üöÄ  Server started on port ${t}\n`),n.success("‚úÖ  Done\n")}(e,n),this._inputData=await this._input.spa(n,this._ignoreUrls,t),this):this}async inputNextJs(e="sitemap.xml",t=3e3){if(!this._inputData)return this;if(!this._nextServer){const{default:e}=await Promise.resolve().then((function(){return d}));this._nextServer=new e(this._logger),await this._nextServer.setup()}return this._logger.printTextToConsole("SEO Analyzer"),this._inputData=await this._nextServer.inputSSR(t,this._ignoreUrls,e),this}inputHTMLStrings(e){if(0!==this._inputData.length)return this;if(!e||!e.length||e.some((e=>void 0===e.text||void 0===e.source))){const t=`Invalid input ${e}`;throw this._logger.error(t),t}return this._logger.printTextToConsole("SEO Analyzer"),this._inputData=this._input.getDom(e),this}addRule(e,t={}){return"string"==typeof e?e in h?this._rules.push({rule:h[e],options:t}):this._logger.error(`\n\n‚ùå  Rule "${e}" not found\n`,1):"function"==typeof e?this._rules.push({rule:e,options:t}):this._logger.error("\n\n‚ùå  Rule must be a function or a string\n",1),this}outputConsole(){return(async()=>{const e=await this._output.object(this._inputData,this._rules);this._logger.result(e,!0)})(),this}outputJson(e){return(async()=>{const t=await this._output.json(this._inputData,this._rules);e(t)})(),this}async outputJsonAsync(){return this._output.json(this._inputData,this._rules)}outputObject(e){return(async()=>{const t=await this._output.object(this._inputData,this._rules);e(t)})(),this}async outputObjectAsync(){return this._output.object(this._inputData,this._rules)}}}));
//# sourceMappingURL=seo-analyzer.js.map
